<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hub de sitios | Boleter√≠a & Rifas</title>
    <link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body class="admin-hub-body">
    <header class="topbar">
        <div class="topbar-left">
            <span class="brand-mark"><span class="logo-mark">üõ†Ô∏è</span></span>
            <div>
                <div class="topbar-title">Hub administrativo</div>
                <div class="topbar-meta">Gestiona la configuraci√≥n de los sitios</div>
            </div>
        </div>
        <div class="topbar-right">
            <a class="btn" href="/">Volver al panel principal</a>
        </div>
    </header>

    <main class="admin-hub">
        <section class="card hero-card admin-hub-hero">
            <div class="hero-grid">
                <div>
                    <p class="eyebrow">Administraci√≥n</p>
                    <h1 class="card-title">Central de sitios</h1>
                    <p class="card-subtitle">Consulta los sitios activos, revisa sus configuraciones y genera nuevas plantillas listas para publicar.</p>
                    <div class="admin-hub-badges">
                        <span class="badge">Lectura directa de assets</span>
                        <span class="badge">Snippets listos para index.json</span>
                        <span class="badge">Checklist Supabase</span>
                        <span class="badge">Control total de accesos</span>
                    </div>
                </div>
                <div class="hero-actions">
                    <div class="mini-card">
                        <p class="eyebrow">Flujo r√°pido</p>
                        <h3 class="card-title">Crear y publicar</h3>
                        <p class="card-subtitle">Genera el config, a√±ade al √≠ndice y asigna administradores en un mismo lugar.</p>
                        <div class="pill-row">
                            <span class="pill">Nuevo sitio</span>
                            <span class="pill">Index.json</span>
                            <span class="pill">Roles</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="card admin-hub-section">
            <div class="section-header">
                <div>
                    <p class="eyebrow">Atajos</p>
                    <h2 class="section-title">Panel de control r√°pido</h2>
                    <p class="section-subtitle">Cards agrupadas para crear sitios, revisar el √≠ndice y administrar accesos sin perder contexto.</p>
                </div>
            </div>
            <div class="quick-actions-grid">
                <div class="mini-card">
                    <p class="eyebrow">Cat√°logo</p>
                    <h3 class="card-title">Sitios detectados</h3>
                    <p class="card-subtitle">Revisa los sitios listados y ejecuta acciones r√°pidas.</p>
                    <div class="form-actions">
                        <button id="reloadSites" class="btn btn-secondary">Actualizar listado</button>
                        <a class="btn btn-ghost" href="#siteDetailsSection">Ver detalles</a>
                    </div>
                </div>
                <div class="mini-card">
                    <p class="eyebrow">Plantillas</p>
                    <h3 class="card-title">Nuevo sitio</h3>
                    <p class="card-subtitle">Completa los campos y descarga un <code>config.json</code> listo.</p>
                    <div class="form-actions">
                        <a class="btn btn-primary" href="#newSiteForm">Generar config</a>
                        <button id="copyNewIndexShortcut" type="button" class="btn btn-secondary" disabled>Copiar entrada index.json</button>
                    </div>
                </div>
                <div class="mini-card">
                    <p class="eyebrow">Accesos</p>
                    <h3 class="card-title">Administradores & usuarios</h3>
                    <p class="card-subtitle">Mant√©n control de roles y cuentas para cada sitio.</p>
                    <div class="form-actions">
                        <a class="btn btn-primary" href="#accessSection">Ir al gestor</a>
                        <button id="copyAccessResume" type="button" class="btn btn-ghost" disabled>Copiar resumen</button>
                    </div>
                </div>
            </div>
        </section>

        <section class="card admin-hub-section">
            <div class="section-header">
                <div>
                    <p class="eyebrow">Sitios existentes</p>
                    <h2 class="section-title">Cat√°logo detectado</h2>
                    <p class="section-subtitle">Se enumeran las entradas presentes en <code>assets/sites/index.json</code>. Ahora puedes revisar acciones r√°pidas o depurar el √≠ndice.</p>
                </div>
                <div class="section-actions">
                    <button id="reloadSitesSecondary" class="btn btn-secondary">Actualizar listado</button>
                </div>
            </div>
            <div id="siteList" class="admin-hub-grid"></div>
            <div id="siteListEmpty" class="empty-state" style="display:none;">
                No se encontraron sitios en el √≠ndice.
            </div>
        </section>

        <section class="card admin-hub-section" id="siteDetailsSection" style="display:none;">
            <div class="section-header">
                <div>
                    <p class="eyebrow">Detalle del sitio</p>
                    <h2 class="section-title" id="siteDetailsTitle">Selecciona un sitio</h2>
                    <p class="section-subtitle">Vista r√°pida de los textos de marca, paleta y rutas configuradas.</p>
                </div>
                <div class="section-actions">
                    <button id="copyIndexSnippet" class="btn btn-secondary" style="display:none;">Copiar entrada para index.json</button>
                </div>
            </div>
            <div id="siteDetails" class="admin-hub-detail"></div>
            <div id="siteActions" class="admin-hub-actions" style="display:none;"></div>
        </section>

        <section class="card admin-hub-section" id="indexChangesSection" style="display:none;">
            <div class="section-header">
                <div>
                    <p class="eyebrow">Cambios locales</p>
                    <h2 class="section-title">Pr√≥xima versi√≥n de index.json</h2>
                    <p class="section-subtitle">Las acciones sobre el listado generan un JSON listo para reemplazar el archivo original.</p>
                </div>
                <div class="section-actions">
                    <button id="copyIndexFull" class="btn btn-secondary" disabled>Copiar JSON completo</button>
                    <button id="downloadIndexFull" class="btn btn-primary" disabled>Descargar index.json</button>
                </div>
            </div>
            <div class="admin-hub-preview">
                <div class="preview-header">
                    <div>
                        <p class="eyebrow">Contenido generado</p>
                        <h3 class="section-title">Vista previa</h3>
                    </div>
                    <span class="badge badge-success" id="indexChangesBadge">Sin cambios pendientes</span>
                </div>
                <pre id="indexFullPreview" class="code-block"></pre>
            </div>
        </section>

        <section class="card admin-hub-section">
            <div class="section-header">
                <div>
                    <p class="eyebrow">Nuevo sitio</p>
                    <h2 class="section-title">Generador de configuraci√≥n</h2>
                    <p class="section-subtitle">Completa los campos y descarga un <code>config.json</code> listo para colocar en <code>assets/sites/&lt;slug&gt;/</code>.</p>
                </div>
                <div class="section-actions">
                    <button id="resetForm" class="btn btn-ghost">Limpiar campos</button>
                </div>
            </div>
            <form id="newSiteForm" class="admin-hub-form">
                <div class="form-grid">
                    <label class="form-group">
                        <span>Slug del sitio</span>
                        <input id="siteSlug" type="text" placeholder="ej. mi-sitio" required minlength="3" maxlength="40">
                        <small>Solo letras, n√∫meros y guiones. Se usa para carpeta, basePath y <code>sitio_slug</code>.</small>
                    </label>
                    <label class="form-group">
                        <span>Nombre visible</span>
                        <input id="siteName" type="text" placeholder="Nombre del sitio" required>
                    </label>
                    <label class="form-group">
                        <span>Base path p√∫blico</span>
                        <input id="siteBasePath" type="text" placeholder="/mi-sitio" required>
                        <small>Incluye la barra inicial. Para el root usa <code>/</code>.</small>
                    </label>
                    <label class="form-group">
                        <span>T√≠tulo del hero</span>
                        <input id="heroTitle" type="text" placeholder="Texto principal del hero">
                    </label>
                    <label class="form-group">
                        <span>Subt√≠tulo del hero</span>
                        <input id="heroSubtitle" type="text" placeholder="Descripci√≥n corta">
                    </label>
                    <label class="form-group">
                        <span>T√≠tulo de la barra superior</span>
                        <input id="topbarTitle" type="text" placeholder="Texto en la barra superior">
                    </label>
                    <label class="form-group">
                        <span>Subt√≠tulo de la barra superior</span>
                        <input id="topbarSubtitle" type="text" placeholder="Texto secundario en la barra">
                    </label>
                    <label class="form-group">
                        <span>S√≠mbolo del logo</span>
                        <input id="logoSymbol" type="text" placeholder="Emoji o car√°cter" maxlength="4">
                    </label>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Generar config</button>
                    <button type="button" id="downloadConfig" class="btn btn-secondary" disabled>Descargar config.json</button>
                    <button type="button" id="copyConfig" class="btn btn-ghost" disabled>Copiar JSON</button>
                    <button type="button" id="copyNewIndex" class="btn btn-ghost" disabled>Copiar entrada index.json</button>
                </div>
            </form>
            <div id="newSitePreview" class="admin-hub-preview" style="display:none;">
                <div class="preview-header">
                    <div>
                        <p class="eyebrow">Resultado</p>
                        <h3 class="section-title">config.json sugerido</h3>
                    </div>
                    <span class="badge badge-success" id="previewBadge">Listo para descargar</span>
                </div>
                <pre id="configPreview" class="code-block"></pre>
                <div class="admin-hub-grid">
                    <div class="admin-hub-card">
                        <p class="eyebrow">Entrada para index.json</p>
                        <pre id="indexPreview" class="code-block"></pre>
                    </div>
                    <div class="admin-hub-card">
                        <p class="eyebrow">Checklist Supabase</p>
                        <pre id="sqlPreview" class="code-block"></pre>
                    </div>
                </div>
            </div>
        </section>

        <section class="card admin-hub-section" id="accessSection">
            <div class="section-header">
                <div>
                    <p class="eyebrow">Roles y credenciales</p>
                    <h2 class="section-title">Gestor de administradores y usuarios</h2>
                    <p class="section-subtitle">Centraliza la asignaci√≥n de administradores y usuarios por sitio. La informaci√≥n se mantiene local para preparar el alta en Supabase.</p>
                </div>
                <div class="section-actions">
                    <label class="form-group compact">
                        <span>Sitio activo</span>
                        <select id="accessSiteSelector"></select>
                    </label>
                    <button id="clearAccess" class="btn btn-ghost" type="button">Limpiar listas</button>
                </div>
            </div>
            <div class="access-grid">
                <div class="access-card">
                    <div class="access-card-header">
                        <div>
                            <p class="eyebrow">Administradores</p>
                            <h3 class="card-title">Control de cuentas</h3>
                            <p class="card-subtitle">Registra usuarios de mantenimiento y su contacto.</p>
                        </div>
                        <span class="badge" id="adminBadge">0 asignados</span>
                    </div>
                    <form id="adminForm" class="admin-hub-form mini">
                        <div class="form-grid">
                            <label class="form-group">
                                <span>Usuario</span>
                                <input id="adminUsername" type="text" placeholder="admin_sitio" required>
                            </label>
                            <label class="form-group">
                                <span>Rol</span>
                                <input id="adminRole" type="text" placeholder="Superadmin, soporte" required>
                            </label>
                            <label class="form-group">
                                <span>Contacto</span>
                                <input id="adminContact" type="text" placeholder="correo o tel√©fono">
                            </label>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" type="submit">Agregar administrador</button>
                            <button class="btn btn-secondary" type="button" id="copyAdmins">Copiar lista</button>
                        </div>
                    </form>
                    <div id="adminList" class="access-list"></div>
                </div>
                <div class="access-card">
                    <div class="access-card-header">
                        <div>
                            <p class="eyebrow">Usuarios</p>
                            <h3 class="card-title">Operadores y vendedores</h3>
                            <p class="card-subtitle">Administra cuentas de uso diario vinculadas al sitio.</p>
                        </div>
                        <span class="badge" id="userBadge">0 registrados</span>
                    </div>
                    <form id="userForm" class="admin-hub-form mini">
                        <div class="form-grid">
                            <label class="form-group">
                                <span>Usuario</span>
                                <input id="userUsername" type="text" placeholder="vendedor_sitio" required>
                            </label>
                            <label class="form-group">
                                <span>Nombre</span>
                                <input id="userName" type="text" placeholder="Nombre completo" required>
                            </label>
                            <label class="form-group">
                                <span>Rol interno</span>
                                <input id="userRole" type="text" placeholder="Vendedor, soporte, lector">
                            </label>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" type="submit">Agregar usuario</button>
                            <button class="btn btn-secondary" type="button" id="copyUsers">Copiar lista</button>
                        </div>
                    </form>
                    <div id="userList" class="access-list"></div>
                </div>
            </div>
        </section>

        <section class="card admin-hub-section">
            <div class="section-header">
                <div>
                    <p class="eyebrow">Notas r√°pidas</p>
                    <h2 class="section-title">Checklist de publicaci√≥n</h2>
                    <p class="section-subtitle">Aseg√∫rate de subir los assets y actualizar los datos en Supabase antes de exponer el sitio.</p>
                </div>
            </div>
            <ul class="admin-hub-list">
                <li>Guarda el archivo generado en <code>assets/sites/&lt;slug&gt;/config.json</code> junto a <code>hero.svg</code> y <code>logo.svg</code>.</li>
                <li>Agrega la entrada al arreglo <code>sites</code> en <code>assets/sites/index.json</code> para que el loader lo detecte.</li>
                <li>Replica la configuraci√≥n de base de datos siguiendo el SQL sugerido y verificando el header <code>x-site-slug</code>.</li>
                <li>Prueba el sitio navegando a su <code>basePath</code> y validando que las im√°genes cargan y los formularios funcionan.</li>
                <li>Comparte la lista de administradores y usuarios generada para actualizarlos en Supabase.</li>
            </ul>
        </section>
    </main>

    <script src="/assets/js/admin-hub.js"></script>
</body>
</html>
